# Answer 4

## A1

1. `0101 011 010 1 00100` ，如果结果是 0，则 2 号机器处于忙碌状态
2. `0101 011 010 1 01100` ，如果结果为 0，则 2 号和 3 号机器均处于忙碌状态
3. `1001 011 010 1 11111` ，如果结果为 0，则全部 8 台机器均处于忙碌状态
4. 不能使用一条指令，因为 0101 的立即数最多只有五位，但可以考虑先将需要的掩码 `0000 0000 0100 0000` 存入寄存器，再使用 `0101` (`AND`) 的寄存器与模式，则可以检测6号机器的工作状态

## A2

如下，先将值 x3101 存到 `R1` 中，再把 M[`R1`+2] 存到 `R2` 中，也就是 x1482.

| Address |        Value        |    Comments    |
| :-----: | :-----------------: | :------------: |
|  x30FF  | 1110 001 000000001  |   LEA R1, #1   |
|  x3100  | 0110 010 001 000010 | LDR R2, R1, #2 |
|  x3101  | 1111 0000 0010 0101 |    TRAP x25    |
|  x3102  | 0001 0100 0100 0001 |     x1441      |
|  x3103  | 0001 0100 1000 0010 |     x1482      |

## A3

1. 如下两条即可.

```
LDR R2, R1, #0
STR R2, R0, #0
```

2. 如下微指令会在 `MOVE` 被解码后执行.

```
MAR <- SR
MDR <- Memory[MAR]
MAR <- DR
Memory[MAR] <- MDR
```

## A4

## A5

## A6

## A7

## A8

## A9

## A10

依次分析每行命令。

- x3000, x3001 将 `R0` 中的值取负数存在 `R0` 中，这用来判断 `R1` 和 `R0` 是否相同，也就是用 `R1` 加上 `-R0` 是否为 0 来判断
- x3002 将 `R2` 中的值置为 0
- x3003 将 `R3` 中的值置为 `R0` 和 `R1` 的和，也就是 `R1` 减去原来的 `R0`，那么接下来的 x3004 应该是一个判断是否为 0 跳转的命令，跳转目标现在还不知道
- x3005 是 `R2` 加 1，之后 x3006 未知，而 x3007 判断若 x3006 结果为 0 则跳转到 x300F. x300F, x3010 将 `R2` 清空后减 1，可以看出这是判断已经不可能让原本的 `R1` 左移成 `R0` 后将结果 -1 存在 `R2` 里，则 x3011 将 `R2` 中值存到 x3020 中，即 ST R2, x3020，这时也可以判断之前的 x3004 应跳转到这里，也就是 BRz x3011
- x3008, x3009 若 `R1` 为负数则跳转到 x300C, x300D 然后跳转到 x3003
- 若 `R1` 为正数，x300A 将 `R1` 翻倍后跳转到 x3003，否则经 x300C, x300D 后跳转到 x3003，而此时为 `R1` 为负数情况，也就是最高位为 1，所以将 `R1` 翻倍后要在最低位加 1，这样就实现了左移 1 位的操作
- 最后思考剩下的 x3006，因为左移 16 位就回到本身，所以如果 `R2` 加到 16 就说明已经不可能左移成 `R0` 了，所以 x3006 应该是判断 `R2` 是否为 16，也就是 ADD R3, R2, #-16

| Address |           Value           |     Comments      |
| :-----: | :-----------------------: | :---------------: |
|  x3000  |    1001 000 000 111111    |    NOT R0, R0     |
|  x3001  |   0001 000 000 1 00001    |  ADD R0, R0, #1   |
|  x3002  |   0101 010 010 1 00000    |  AND R2, R2, #0   |
|  x3003  |   0001 011 000 0 00 001   |  ADD R3, R0, R1   |
|  x3004  |  **0000 010 000001100**   |     BRz x3011     |
|  x3005  |   0001 010 010 1 00001    |  ADD R2, R2, #1   |
|  x3006  | **0001 011 010 1 10000**  | ADD R3, R2, #-16  |
|  x3007  |    0000 010 000000111     |     BRz x300F     |
|  x3008  |   0101 001 001 1 11111    | AND R1, R1, xFFFF |
|  x3009  |    0000 100 000000010     |     BRn x300C     |
|  x300A  |   0001 001 001 0 00 001   |  ADD R1, R1, R1   |
|  x300B  |    0000 111 111110111     |    BRnzp x3003    |
|  x300C  | **0001 001 001 0 00 001** |  ADD R1, R1, R1   |
|  x300D  | **0001 001 001 1 00001**  |  ADD R1, R1, #1   |
|  x300E  |    0000 111 111110100     |    BRnzp x3003    |
|  x300F  |   0101 010 010 1 00000    |  AND R2, R2, #0   |
|  x3010  |   0001 010 010 1 11111    |  ADD R2, R2, #-1  |
|  x3011  |  **0011 010 000001110**   |   ST R2, x3020    |
|  x3012  |    1111 0000 0010 0101    |     TRAP x025     |
